---
import image1 from '../assets/v5s.jpg';
import image2 from '../assets/v4s.jpg';

import { getLanguageFromUrl, t, setCurrentLanguage } from '../i18n/utils/translator';

const currentLang = getLanguageFromUrl(Astro.url.pathname);
setCurrentLanguage(currentLang);

const carouselImages = [
  { src: image1.src, alt: t('coliving.carousel.image1_alt') },
  { src: image2.src, alt: t('coliving.carousel.image2_alt') }
];
---

<section
  id="coliving"
  class="section bg-gradient-to-b from-pixel-purple/5 via-white to-pixel-purple/10"
>
  <div class="container mx-auto px-4 md:px-20">

    <!-- Encabezado -->
    <div class="text-center mb-12 md:mb-16">
      <span class="inline-block text-pixel-purple font-semibold text-xs md:text-sm uppercase tracking-[0.2em] mb-3">
        {t('coliving.community.badge')}
      </span>
      <h2 class="text-3xl md:text-5xl lg:text-6xl font-normal mb-4 md:mb-6 leading-tight">
        {t('coliving.community.heading')}
      </h2>
      <p class="text-base md:text-lg text-gray-600 max-w-2xl mx-auto">
        {t('coliving.community.intro_1')}
      </p>
    </div>
    
    <!-- GRID 2 COLUMNAS: TEXTO + CARRUSEL -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 lg:gap-16 max-w-7xl mx-auto mb-6 md:mb-10">

      <!-- COLUMNA IZQUIERDA -->
      <div class="flex">
        <div class="flex flex-col justify-center space-y-6 md:space-y-8 bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-violet-100 p-6 md:p-8">
          
          <!-- Intro -->
          <div class="space-y-3 md:space-y-4 text-left">
            <p class="text-base md:text-lg text-gray-900">
              {t('coliving.community.intro_2')}
            </p>
            <p class="text-base md:text-lg text-gray-700">
              {t('coliving.community.intro_3')}
            </p>
            <p class="text-base md:text-lg text-gray-700">
              {t('coliving.community.intro_4')}
            </p>
          </div>

          <!-- Quiénes se hospedan -->
          <div class="space-y-2 md:space-y-3 text-left">
            <h3 class="text-lg md:text-xl font-semibold text-pixel-purple">
              {t('coliving.community.quienes_titulo')}
            </h3>
            <ul class="list-disc list-inside text-gray-700 space-y-1.5 text-sm md:text-base">
              <li>{t('coliving.community.quienes_1')}</li>
              <li>{t('coliving.community.quienes_2')}</li>
              <li>{t('coliving.community.quienes_3')}</li>
              <li>{t('coliving.community.quienes_4')}</li>
              <li>{t('coliving.community.quienes_5')}</li>
              <li>{t('coliving.community.quienes_6')}</li>
            </ul>
          </div>

          <!-- Lo que la hace única -->
          <div class="space-y-2 md:space-y-3 text-left">
            <h3 class="text-lg md:text-xl font-semibold text-pixel-purple">
              {t('coliving.community.unica_titulo')}
            </h3>
            <ul class="list-disc list-inside text-gray-700 space-y-1.5 text-sm md:text-base">
              <li>{t('coliving.community.unica_1')}</li>
              <li>{t('coliving.community.unica_2')}</li>
              <li>{t('coliving.community.unica_3')}</li>
            </ul>
          </div>

          <p class="text-base md:text-lg text-gray-900">
            {t('coliving.community.cierre')}
          </p>

          <!-- CTA -->
          <div class="pt-2">
            <a
              href="#reservas"
              class="inline-flex items-center justify-center rounded-full px-6 md:px-8 py-2.5 md:py-3 text-sm md:text-base font-semibold bg-pixel-purple text-white shadow-md hover:shadow-lg hover:bg-purple-700 transition-all"
            >
              {t('coliving.community.cta')}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-4 h-4 md:w-5 md:h-5 ml-2"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
              </svg>
            </a>
          </div>
        </div>
      </div>
      
      <!-- COLUMNA CARRUSEL -->
      <div class="flex flex-col">
        <div class="relative overflow-hidden rounded-2xl border border-pixel-purple/40 bg-white shadow-xl">
          <div id="coliving-carousel" class="flex transition-transform duration-500 ease-out">
            {carouselImages.map((image) => (
              <div class="w-full flex-shrink-0">
                <div class="aspect-[4/5] md:aspect-square">
                  <img
                    src={image.src}
                    alt={image.alt}
                    class="w-full h-full object-cover"
                  />
                </div>
              </div>
            ))}
          </div>

          <!-- Indicadores -->
          <div class="absolute bottom-4 left-0 right-0 flex justify-center space-x-2">
            {carouselImages.map((_, index) => (
              <button 
                class="w-2.5 h-2.5 rounded-full bg-white/80 border border-pixel-purple/60 opacity-60 hover:opacity-100 transition-opacity coliving-indicator"
                data-index={index}
                aria-label={t('coliving.carousel.indicator_label')
                  .replace('{{index}}', (index + 1).toString())
                  .replace('{{total}}', carouselImages.length.toString())
                }
              ></button>
            ))}
          </div>
        </div>

        <!-- Controles -->
        <div class="flex justify-center items-center space-x-4 mt-4">
          <button
            id="coliving-prev"
            class="bg-white border border-pixel-purple/40 text-pixel-purple p-2 md:p-2.5 rounded-full shadow-sm hover:shadow-md hover:bg-pixel-purple hover:text-white transition"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-5 h-5"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
          </button>

          <button
            id="coliving-next"
            class="bg-white border border-pixel-purple/40 text-pixel-purple p-2 md:p-2.5 rounded-full shadow-sm hover:shadow-md hover:bg-pixel-purple hover:text-white transition"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-5 h-5"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>
        </div>

      </div>

    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const carousel = document.getElementById('coliving-carousel');
    const prevBtn = document.getElementById('coliving-prev');
    const nextBtn = document.getElementById('coliving-next');
    const indicators = document.querySelectorAll('.coliving-indicator');
    
    const totalImages = indicators.length;
    
    let currentIndex = 0;
    
    function updateCarousel() {
      if (carousel) {
        carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
      }
      
      indicators.forEach((indicator, index) => {
        if (index === currentIndex) {
          indicator.classList.add('opacity-100');
          indicator.classList.remove('opacity-50');
        } else {
          indicator.classList.add('opacity-50');
          indicator.classList.remove('opacity-100');
        }
      });
    }
    
    prevBtn?.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + totalImages) % totalImages;
      updateCarousel();
    });
    
    nextBtn?.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % totalImages;
      updateCarousel();
    });
    
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        currentIndex = index;
        updateCarousel();
      });
    });
    
    updateCarousel();
    
    const interval = setInterval(() => {
      currentIndex = (currentIndex + 1) % totalImages;
      updateCarousel();
    }, 5000);
    
    carousel?.addEventListener('mouseenter', () => {
      clearInterval(interval);
    });
  });
</script>